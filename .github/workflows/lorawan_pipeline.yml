name: ğŸ¤– YOLO + BLIP Pipeline

on:
  workflow_dispatch:  # permite execuÃ§Ã£o manual
  push:
    paths:
      - 'detect_yolo.py'
      - 'src/**'
      - 'data/**'
      - 'results/yolo/crops/**'
      - '.github/workflows/yolo_blip_pipeline.yml'

jobs:
  pipeline:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout do repositÃ³rio
        uses: actions/checkout@v3

      - name: ğŸ Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: ğŸ“¦ Instalar dependÃªncias do projeto
        run: |
          pip install torch torchvision
          pip install opencv-python matplotlib pandas pillow tqdm transformers

      - name: ğŸ§  Clonar YOLOv5 e instalar requirements
        run: |
          git clone https://github.com/ultralytics/yolov5.git
          pip install -r yolov5/requirements.txt

      - name: ğŸ” Etapa 1 - DetecÃ§Ã£o com YOLOv5
        run: python detect_yolo.py

      - name: ğŸ”¤ Etapa 2 - Captioning com BLIP
        run: python src/captioning/generate_blip_captions.py

      - name: ğŸ’¾ Commit de resultados (opcional)
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ”„ Pipeline automÃ¡tica: YOLO + BLIP"
          file_pattern: |
            results/yolo/**
            results/blip/captions/*

